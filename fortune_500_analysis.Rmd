---
title: "final_planning"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# How did the rise in technology usage (social media, internet, etc..) aid or hurt historically successful businesses/industries? 


Loading Packages
```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(forcats)
library(lubridate)
library(sparklyr)
library(ggthemes)
library(gridExtra)
library(readxl)
library(stringr)
library(readr)
setwd("/Users/franklinglance/Library/CloudStorage/OneDrive-UniversityofVirginia/UVA/Spring 2022/SYS 2202/Final Project/Fortune_500_Analysis")
```

## Importing Data
```{r}
# us company data for 2021 Data was collected for the year end February 2021
fortune_1000 <- read_csv("data/Fortune_1000.csv") # provides sector info for selection of fortune 500 companies


fortune1955_2021 <- read_csv("data/fortune500_1955_2021.csv")  # rank + revenue data for fortune 500 companies


internet_indicators_data <- read_csv("data/data_internet_plus_indicators/56437442-eef4-42c7-ba08-45ad275860fb_data.csv") 

technology_adoption_by_households_in_the_united_states <- read_csv("data/technology-adoption-by-households-in-the-united-states.csv")

computing_efficiency <- read_csv("data/computing-efficiency.csv")

price_changes_in_consumer_goods_and_services_in_the_usa_1997_2017 <- read_csv("data/price-changes-in-consumer-goods-and-services-in-the-usa-1997-2017.csv")

X2021_Edition_CNTSDATA <- read_excel("data/2021 Edition CNTSDATA files with LINKS/2021 Edition CNTSDATA.xlsx")

# data on various business indicators (see metadata)
data_bisiness_indicators <- read_csv("data/data_business_indicators/aee336d2-021b-4021-912c-3de7fd9d2729_Data.csv")

# data on supercomputer power
supercomputer_power_flops <- read_csv("data/supercomputer-power-flops.csv")


# ai computation arrivals
ai_training_computation <- read_csv("data/ai-training-computation.csv")
```

## Tidying Data

Prepare Fortune 1000 and Fortune1995_2021 for joining + join by company
```{r}
fortune_1000 <- fortune_1000 %>%
  mutate(Company = company)
fortune1955_2021 <- fortune1955_2021 %>%
  mutate(Company = Name)
```


```{r}
fortune_joined <- fortune_1000 %>%
  left_join(fortune1955_2021, by = "Company") %>%
  drop_na(sector)
# drop irrelavent columns
fortune_joined <- fortune_joined %>% 
  select(-c(rank, rank_change, revenue, profit, `num. of employees`, profitable, prev_rank, `Market Cap`))
```

Tidying Fortune Joined Dataset

- Revenue is now in billions of dollars
```{r}
# changing revenue to numeric type, now in billions of dollars
fortune_joined <- fortune_joined %>%
  transform(Revenue = as.integer(Revenue)) %>%
  mutate(Revenue = Revenue/1000) %>%
  transform(Revenue = as.integer(Revenue))
fortune_joined
```


## Determining which companies are "successful" vs. "unsuccessful

### Can rank and Revenue be used synonomously when talking about success?

It appears that there is absolutely a correlation between rank and revenue, especially when looking at companies ranked in the top 200. Therefore, we will choose to focus on top 200 ranked companies, since lower ranking companies do not appear to differ significantly in revenue. 
```{r}
fortune_joined %>%
  filter(Year > 1985) %>%
  group_by(Rank) %>%
  summarise(mean_revenue_by_rank = mean(Revenue, na.rm = TRUE)) %>%
  ggplot(aes(Rank, mean_revenue_by_rank)) +
  geom_smooth() + 
  labs(title = "Mean Revenue by Rank, Fortune 500 from 1985 to 2021", 
       subtitle = "Displays correlation between rank and revenue") +
  ylab("Mean Revenue (in billions)") + 
  scale_x_continuous(trans = "reverse")
```

Viewing top 20 companes that have been on this list the longest.
```{r}
head(fortune_joined %>% count(Company, sort=TRUE), n=20)
```
Listing companies which have been on the fortune 500 for more than 20 years, after 1985.
```{r}

head(fortune_joined %>% count(Company, sort=TRUE), n=20)

# filtering by companies on the list for 20 years, since 1985
fortune_joined %>% 
  group_by(Company) %>%
  filter(Year > 1985) %>%
  filter(n() > 20) %>%
  summarise(unique(Company), n()) %>%
  arrange(desc(n()))
```


Now we will filter for companies who have been on the fortune 500 the entire time
```{r}
fortune_joined %>% 
  group_by(Company) %>%
  filter(Year > 1985) %>%
  filter(n() > 35) 
```


We know that the top 100 companes typically show the greatest correlation between rank and revenue, so we will filter for companes which were in the top 100 in 2021, and have been on the list since 1985. They are the following:
```{r}
top_100 <- fortune_joined %>% 
  group_by(Company) %>%
  filter(Year > 1985) %>%
  filter(n() > 35) %>%
  group_by(Company) %>%
  filter(Year == 2021) %>%
  filter(Rank < 100) %>%
  summarise(Company)
```

Choosing a distinct set of several "successful" businesses will allow a more in depth analysis when analyzing correlation with technological advancements. 
```{r}
as.vector(top_100)


fortune_joined %>% 
  group_by(Company) %>%
  filter(Year > 1985) %>%
  filter(n() > 35) %>%
  filter(Company %in% as.vector(top_100))



  ggplot(mapping = aes(Year, Rank, color=Company)) +
  geom_line(aes(linetype=Company), size=1) +
  labs(title='Fortune 500 Rank - Apple, Exxon Mobil, Ford, General Motors, from 1985-2021') +
  scale_y_continuous(breaks = seq(0, 300, by=30), limits=c(300,1), trans = 'reverse') 
```

It appears that 1994 and 2000 are significant years for Apple. Let us see if there is any similar trend for other companies during those time-frames. 





The previous analysis has aided in determining the following insights about fortune 500 companies. 
- There is a correlation between rank and revenue
- Good subset of Companies to analyze are:
  - 


Preparing data from data_business_indicators
```{r}

```


Preparing data on USA from CNTSDATA
```{r}
USA_CNTSDATA <- X2021_Edition_CNTSDATA %>%
  filter(`Country Code` == 1220)
```


Display rough distribution of sectors over the years
```{r}

fortune_joined %>%
  group_by(Year, sector) %>%
  filter(Rank < 20) %>%
  filter(Year > 1990) %>%
  ggplot(aes(Year)) +
  geom_bar(aes(fill = sector)) + 
  labs(title = "Sectors of Top companies on Fortune 500 since 1990")
           

fortune_joined %>%
  group_by(Year, sector) %>%
  ggplot(aes(Year)) +
  geom_bar(aes(fill = sector)) +
  labs(title = "Successful Businesses Sector Distribution Over the Years")

technology_adoption_by_households_in_the_united_states %>% 
  group_by(Year) %>% 
  ggplot(aes(Year, `Technology Diffusion (Comin and Hobijn (2004) and others)`)) +
  geom_col()


computing_efficiency %>%
  group_by(Year) %>%
  ggplot(aes(Year, log10(`Computing efficiency`))) +
  geom_line() +
  labs(title = "Computing efficiency, 1971 to 2015", 
       subtitle = "Computer processing efficiency, measured as the number of watts needed per million instructions per second - Watts per MIPS.") + 
  ylab("Computing Efficiency")
```

## Variable Breakdown (tentative)

Independent Variables:
- Internet Usage from 1990-2019
- Tech adoption by household 
- social network usage/reach among fortune 500 ceos (2012 - 2016)
- Broadband usage by household
- Sector (selecting by sector)

Dependent Variables:
- Sector, Revenue, Rank, -> used to indicate relative "success" of a company over the years







